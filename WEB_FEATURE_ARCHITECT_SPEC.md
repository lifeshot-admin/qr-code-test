# WEB_FEATURE_ARCHITECT_SPEC.md

## Cheiz í†µí•© ì›¹ â€” í”¼ì²˜ ì•„í‚¤í…íŠ¸ ëª…ì„¸ì„œ

> **ëª©ì **: cheiz-app(React Native)ê³¼ cheiz-web(Bubble ê¸°ë°˜ ì›¹)ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ **í•˜ë‚˜ì˜ Next.js 14 ì›¹ í”„ë¡œì íŠ¸**ë¡œ í†µí•©í•˜ê¸° ìœ„í•œ ìˆ˜ì„ ì•„í‚¤í…íŠ¸ ë ˆë²¨ ì„¤ê³„ ë¬¸ì„œ
>
> **ì°¸ì¡° ë¬¸ì„œ**:
> - `PROJECT_CONTEXT_FOR_AI.md` â€” í˜„ì¬ ì›¹ í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸
> - `geminiì „ìš©_ì•±ë¬¸ì„œ.txt` (INTEGRATED_BUSINESS_ARCH.md) â€” ì•± ì•„í‚¤í…ì²˜ ë¶„ì„ì„œ
>
> **ì‘ì„±ì¼**: 2026-02-14

---

## ëª©ì°¨

1. [ë°ì´í„° ìœ„ê³„ ë° ERD â€” ì•±â†”ì›¹ ì—”í‹°í‹° ëŒ€ì‘ ë¶„ì„](#1-ë°ì´í„°-ìœ„ê³„-ë°-erd)
2. [API ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ â€” í†µí•© ì—ëŸ¬ í•¸ë“¤ë§ ì„¤ê³„](#2-api-ì˜ˆì™¸-ì²˜ë¦¬-ë¡œì§)
3. [ì¸ì¦ ë° ì„¸ì…˜ ìœ ì§€ â€” JWT ì´ì¤‘ í†µì‹  êµ¬ì¡° ë¶„ì„](#3-ì¸ì¦-ë°-ì„¸ì…˜-ìœ ì§€)
4. [í†µí•© ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œë“œë§µ](#4-í†µí•©-ë§ˆì´ê·¸ë ˆì´ì…˜-ë¡œë“œë§µ)

---

## 1. ë°ì´í„° ìœ„ê³„ ë° ERD

### 1.1 ì•±â†”ì›¹ ì—”í‹°í‹° 1:1 ëŒ€ì‘í‘œ

ì•±(Java ë°±ì—”ë“œ)ê³¼ ì›¹(Bubble.io)ì€ **ë™ì¼í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸**ì„ ì„œë¡œ ë‹¤ë¥¸ DBì—ì„œ í‘œí˜„í•©ë‹ˆë‹¤. ì•„ë˜ëŠ” ì •ë°€ ëŒ€ì‘ ë¶„ì„ì…ë‹ˆë‹¤.

| # | ì•± ì—”í‹°í‹° (Java) | ì›¹ ì—”í‹°í‹° (Bubble) | ID ì²´ê³„ | ëŒ€ì‘ ê´€ê³„ | ê°­ ë¶„ì„ |
|---|-----------------|-------------------|---------|----------|---------|
| 1 | **Tour** (`id: number`) | **tour** (`_id: string`, `tour_Id: number`) | Java `id` = Bubble `tour_Id` | **1:1 ì™„ì „ ëŒ€ì‘** | Bubbleì— `location`, `googleMapUrl` ì—†ìŒ â†’ ë³„ë„ `spot` í…Œì´ë¸”ë¡œ ë¶„ë¦¬ë¨ |
| 2 | **Schedule** (`id: number`) | *(í•´ë‹¹ ì—†ìŒ)* | â€” | **ì›¹ì— ë¶€ì¬** | ì•±ì˜ Schedule = íˆ¬ì–´ì˜ íŠ¹ì • ë‚ ì§œ/ì‹œê°„ ìŠ¬ë¡¯. ì›¹ì—ì„œëŠ” `tour.tour_date`ë¡œ ë‹¨ìˆœí™”ë¨. í†µí•© ì‹œ Schedule ê°œë… ë„ì… í•„ìš” |
| 3 | **Folder** (`id: number`) = ì˜ˆì•½ | **pose_reservation** (`_id: string`, `folder_Id: number`) | Java `folder.id` = Bubble `pose_reservation.folder_Id` | **1:1 ëŒ€ì‘ (í•µì‹¬ ì—°ê²°ì )** | ì•„ë˜ ìƒíƒœ ë§¤í•‘ ì°¸ì¡° |
| 4 | **FolderPhoto** | **pose_reservation.auth_photo** | â€” | **ë¶€ë¶„ ëŒ€ì‘** | ì•±: ë³µìˆ˜ ì‚¬ì§„(RAW/COLOR/DETAIL). ì›¹: ë‹¨ì¼ ì¸ì¦ì‚¬ì§„(base64). í†µí•© ì‹œ FolderPhoto í…Œì´ë¸” í•„ìš” |
| 5 | **Order** | *(ë¯¸êµ¬í˜„)* | â€” | **ì›¹ì— ë¶€ì¬** | `app/api/v1/orders/route.ts.deprecated` ì¡´ì¬. Stripe ê²°ì œ ì—°ë™ ì‹œ êµ¬í˜„ í•„ìš” |
| 6 | **Album** / **AlbumPhoto** | *(í•´ë‹¹ ì—†ìŒ)* | â€” | **ì›¹ì— ë¶€ì¬** | ë³´ì • ì‚¬ì§„ í”Œë¡œìš° ì „ì²´ ë¯¸êµ¬í˜„ |
| 7 | **Payment** | *(ë¯¸êµ¬í˜„)* | â€” | **ì›¹ì— ë¶€ì¬** | Stripe ì—°ë™ í•„ìš” |
| 8 | **User** (`id: number`) | *(Bubbleì— ì—†ìŒ, Javaì—ë§Œ ì¡´ì¬)* | Java `user.id` = Bubble `pose_reservation.user_Id` | **ê°„ì ‘ ì°¸ì¡°** | Bubbleì˜ `review.user`ëŠ” Bubble ìì²´ User ì°¸ì¡°. Java Userì™€ ë³„ê°œ |
| 9 | *(í•´ë‹¹ ì—†ìŒ)* | **spot** (`_id: string`, `spot_Id: number`) | â€” | **ì•±ì— ë¶€ì¬** | ì•±ì—ì„œëŠ” Tourì˜ `location` í•„ë“œë¡œ í‘œí˜„. ì›¹ì˜ spot = ì•±ì˜ Tour.location ì„¸ë¶„í™” |
| 10 | *(í•´ë‹¹ ì—†ìŒ)* | **spot_pose** (`_id: string`) | â€” | **ì•±ì— ë¶€ì¬** | ì•±ì—ëŠ” í¬ì¦ˆ ì„ íƒ ê°œë… ì—†ìŒ. ì›¹ ê³ ìœ  ê¸°ëŠ¥ |
| 11 | *(í•´ë‹¹ ì—†ìŒ)* | **reserved_pose** | â€” | **ì•±ì— ë¶€ì¬** | ì›¹ ê³ ìœ : ê°œë³„ í¬ì¦ˆ ì˜ˆì•½ ë ˆì½”ë“œ |
| 12 | **Retoucher** | *(í•´ë‹¹ ì—†ìŒ)* | â€” | **ì›¹ì— ë¶€ì¬** | ë³´ì • í”Œë¡œìš° ë¯¸êµ¬í˜„ |
| 13 | **Company** | *(í•´ë‹¹ ì—†ìŒ)* | â€” | **ì›¹ì— ë¶€ì¬** | íˆ¬ì–´ ìš´ì˜ íšŒì‚¬ ì •ë³´ |
| 14 | *(í•´ë‹¹ ì—†ìŒ)* | **excel_coupon** | â€” | **ì•±ì— ë¶€ì¬** | Bubble ì „ìš© ì¿ í° ì‹œìŠ¤í…œ (ë‚ ì§œ+ì „í™”ë²ˆí˜¸ ê¸°ë°˜) |
| 15 | *(í•´ë‹¹ ì—†ìŒ)* | **review** | â€” | **ì•±ì— ë¶€ì¬** (ì•±ì€ ë³„ë„ ë¦¬ë·° ì‹œìŠ¤í…œ) | Bubbleì— ì €ì¥ëœ ë¦¬ë·° ë°ì´í„° |
| 16 | **Gift/Wallet/IssuedCoupon** | *(í•´ë‹¹ ì—†ìŒ)* | â€” | **ì›¹ì— ë¶€ì¬** | ì•±ì˜ í¬ë ˆë”§/ì¿ í° ì‹œìŠ¤í…œ |

---

### 1.2 Folder â†” pose_reservation ìƒíƒœ ë§¤í•‘

ì´ê²ƒì´ í†µí•©ì˜ **ê°€ì¥ í•µì‹¬ì ì¸ êµì°¨ì **ì…ë‹ˆë‹¤. ë‘ ì‹œìŠ¤í…œ ëª¨ë‘ "ì˜ˆì•½"ì„ ê´€ë¦¬í•˜ì§€ë§Œ ìƒíƒœ ì²´ê³„ê°€ ë‹¤ë¦…ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ì•± FolderStatus          â†”       ì›¹ pose_reservation.status   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  PAYMENT_IN_PROGRESS  â”€â”€â”€â”€â”€â†’  (ì›¹ì— ì—†ìŒ) â€» ì›¹ì€ ë¬´ë£Œ ì˜ˆì•½ë§Œ ì§€ì›           â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚      RESERVED  â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º "Reserved" (Bubble)                        â”‚
â”‚         â”‚                           â”‚                                       â”‚
â”‚         â”‚ (ì´¬ì˜ ë‹¹ì¼)                â”‚                                       â”‚
â”‚         â–¼                           â”‚                                       â”‚
â”‚      PENDING   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  (ì›¹ì— ì—†ìŒ) â€» ì›¹ì€ ë‹¹ì¼ ìƒíƒœ ì „í™˜ ì—†ìŒ       â”‚
â”‚         â”‚                           â”‚                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                      â”‚                                       â”‚
â”‚    â–¼         â–¼                      â–¼                                       â”‚
â”‚ COMPLETED  NO_SHOW  â—„â•â•â•â•â•â•â•â•â–º "Completed" (Bubble)                        â”‚
â”‚                                                                             â”‚
â”‚  CANCELED  â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º (DELETE from Bubble)                       â”‚
â”‚                                     â€» ì›¹ì€ ìƒíƒœ ë³€ê²½ì´ ì•„ë‹Œ ë ˆì½”ë“œ ì‚­ì œ      â”‚
â”‚                                                                             â”‚
â”‚  CANCELED_BY_SCHEDULE  â”€â”€â”€â”€â”€â†’  (ì›¹ì— ì—†ìŒ)                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í†µí•© ì‹œ í•„ìš”í•œ ê²°ì •**:

| ê²°ì • ì‚¬í•­ | ê¶Œì¥ì•ˆ |
|----------|--------|
| ì·¨ì†Œ ë°©ì‹ í†µì¼ | ì•±ì²˜ëŸ¼ ìƒíƒœ ë³€ê²½(`CANCELED`)ìœ¼ë¡œ í†µì¼. Bubble DELETE â†’ PATCH `status: "Canceled"`ë¡œ ë³€ê²½ |
| PENDING ìƒíƒœ ë„ì… | Schedule ê¸°ë°˜ìœ¼ë¡œ ë‹¹ì¼ ìë™ ì „í™˜ ë¡œì§ í•„ìš” (ì„œë²„ì‚¬ì´ë“œ cron ë˜ëŠ” Java ë°±ì—”ë“œ ìœ„ì„) |
| NO_SHOW ë„ì… | í¬í† ê·¸ë˜í¼ê°€ QR ë¯¸ìŠ¤ìº” ì‹œ ì¼ì • ì‹œê°„ í›„ ìë™ NO_SHOW ì²˜ë¦¬ (ë°±ì—”ë“œ ë¡œì§) |
| PAYMENT_IN_PROGRESS | Stripe ê²°ì œ ì—°ë™ ì‹œ í•„ìˆ˜. `pose_reservation`ì— ê²°ì œ ìƒíƒœ í•„ë“œ ì¶”ê°€ |

---

### 1.3 í†µí•© ERD (ëª©í‘œ ìƒíƒœ)

ë‘ ì‹œìŠ¤í…œì„ í•©ì¹˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í†µí•© ë°ì´í„° ëª¨ë¸ì´ ë©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  Tour    â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ Schedule â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚     Folder       â”‚
â”‚ (Java)  â”‚       â”‚ (Java+   â”‚       â”‚ (Java)   â”‚       â”‚ (= pose_reser-   â”‚
â”‚ id:num  â”‚       â”‚  Bubble) â”‚       â”‚ id:num   â”‚       â”‚   vation)        â”‚
â”‚ roles[] â”‚       â”‚ id:num   â”‚       â”‚ tourId   â”‚       â”‚ id:num(Java)     â”‚
â”‚ nicknameâ”‚       â”‚ _id:str  â”‚       â”‚ startTimeâ”‚       â”‚ _id:str(Bubble)  â”‚
â”‚ email   â”‚       â”‚ (Bubble) â”‚       â”‚ endTime  â”‚       â”‚ folder_Id:num    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚ isActive â”‚       â”‚ tour_Id:num      â”‚
     â”‚                  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ user_Id:num      â”‚
     â”‚                  â”‚                                â”‚ status           â”‚
     â”‚                  â–¼                                â”‚ auth_photo       â”‚
     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚ qrCodeUrl        â”‚
     â”‚            â”‚   Spot   â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚            â”‚ (Bubble) â”‚                                    â”‚
     â”‚            â”‚ spot_Id  â”‚â—„â”€â”€â”€â”€ spot_pose â”€â”€â”€â”€â–¶ reserved_pose â”‚
     â”‚            â”‚ spot_nameâ”‚      â”‚ persona  â”‚    â”‚ spot_pose_Idâ”‚
     â”‚            â”‚ thumbnailâ”‚      â”‚ image    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”œâ”€â”€â”€â”€â–¶â”‚  Order   â”‚â”€â”€â”€â–¶â”‚  Album   â”‚â”€â”€â”€â–¶â”‚AlbumPhotoâ”‚
     â”‚     â”‚ (Java)   â”‚    â”‚ (Java)   â”‚    â”‚ (Java)   â”‚
     â”‚     â”‚ orderId  â”‚    â”‚ albumId  â”‚    â”‚ photoUrl â”‚
     â”‚     â”‚ folderId â”‚    â”‚ status   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚     â”‚ totalPay â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â”€â”€â”€â–¶ Payment (Stripe) â”€â”€â”€â”€ targetType: 'FOLDER' | 'PHOTO_ORDER'
```

**ì´ì¤‘ ID ë¸Œë¦¿ì§€**:
```
Java ë°±ì—”ë“œ                    Bubble.io
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Tour.id (number)     â•â•â•â•â•â•â•  tour.tour_Id (number)
Folder.id (number)   â•â•â•â•â•â•â•  pose_reservation.folder_Id (number)
User.id (number)     â•â•â•â•â•â•â•  pose_reservation.user_Id (number)
                               pose_reservation._id (Bubble ë‚´ë¶€ string ID)
```

`folder_Id`ê°€ ë‘ ì‹œìŠ¤í…œì„ ì—°ê²°í•˜ëŠ” **ë¸Œë¦¿ì§€ í‚¤**ì…ë‹ˆë‹¤. Java ë°±ì—”ë“œì—ì„œ Folderë¥¼ ìƒì„±í•˜ë©´ ê·¸ `id`ê°€ Bubbleì˜ `pose_reservation.folder_Id`ì— ê¸°ë¡ë©ë‹ˆë‹¤.

---

### 1.4 ì›¹ì— ì—†ëŠ” ì•± ì „ìš© ì—”í‹°í‹° â€” êµ¬í˜„ ìš°ì„ ìˆœìœ„

| ì—”í‹°í‹° | í†µí•© ì¤‘ìš”ë„ | êµ¬í˜„ ë°©ì‹ ê¶Œì¥ |
|--------|:---------:|--------------|
| Schedule | â­â­â­â­â­ | Java ë°±ì—”ë“œ API í˜¸ì¶œ (`GET /api/v1/schedules?tourId=`) â†’ ì›¹ì—ì„œ ìŠ¤ì¼€ì¤„ ì„ íƒ UI ì¶”ê°€ |
| Order | â­â­â­â­â­ | Java ë°±ì—”ë“œ API (`POST /api/v1/orders`) + Stripe.js Elements |
| Payment | â­â­â­â­â­ | Stripe Webhook route (`app/api/payment/webhook/route.ts`) ì‹ ê·œ ìƒì„± |
| Album/AlbumPhoto | â­â­â­â­ | Java ë°±ì—”ë“œ API (`GET /api/v1/albums/{id}`) + ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ UI |
| FolderPhoto | â­â­â­ | í¬í† ê·¸ë˜í¼ ì´¬ì˜ ì‚¬ì§„ ì—´ëŒ (í˜„ì¬ëŠ” auth_photoë§Œ ì¡´ì¬) |
| Retoucher | â­â­â­ | ì£¼ë¬¸ í”Œë¡œìš°ì—ì„œ ë¦¬í„°ì²˜ ì„ íƒ UI |
| Company | â­â­ | íˆ¬ì–´ ìƒì„¸ í˜ì´ì§€ì— íšŒì‚¬ ì •ë³´ í‘œì‹œ |
| Gift/Wallet | â­â­ | ê²°ì œ ì‹œ í¬ë ˆë”§ ì°¨ê° ë¡œì§ |
| FolderInvitation | â­ | ê·¸ë£¹ ì˜ˆì•½ ì‹œ ì´ˆëŒ€ ê¸°ëŠ¥ |

---

## 2. API ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§

### 2.1 í˜„ì¬ ì›¹ì˜ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´ ë¶„ì„

`lib/bubble-api.ts`ì˜ ì—ëŸ¬ ì²˜ë¦¬ëŠ” **ë°©ì–´ì  ì¹¨ë¬µ(Defensive Silence)** íŒ¨í„´ì…ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ì›¹ í˜„ì¬ íŒ¨í„´: Defensive Silence                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Bubble API í˜¸ì¶œ]                                               â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€ ì„¤ì • ëˆ„ë½ (BASE_URL/TOKEN)                               â”‚
â”‚       â”‚   â””â”€ console.warn â†’ return null / []                     â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€ HTTP ì—ëŸ¬ (!res.ok)                                      â”‚
â”‚       â”‚   â””â”€ console.error â†’ return null / []                    â”‚
â”‚       â”‚   âš ï¸ ì˜ˆì™¸: updateAuthPhotoë§Œ throw                       â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€ JSON íŒŒì‹± ì‹¤íŒ¨                                           â”‚
â”‚       â”‚   â””â”€ catch â†’ console.error â†’ return null / []            â”‚
â”‚       â”‚                                                          â”‚
â”‚       â””â”€ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬                                             â”‚
â”‚           â””â”€ catch â†’ console.error â†’ return null / []            â”‚
â”‚                                                                  â”‚
â”‚  [API Route Layer]                                               â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€ lib í•¨ìˆ˜ê°€ null/[] ë°˜í™˜                                   â”‚
â”‚       â”‚   â””â”€ Route: 404 ë˜ëŠ” ë¹ˆ ë°°ì—´ ì‘ë‹µ                         â”‚
â”‚       â”‚   âš ï¸ ì›ë³¸ ì—ëŸ¬ ì •ë³´ ìœ ì‹¤                                   â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€ ì§ì ‘ Bubble fetch (mutation routes)                      â”‚
â”‚       â”‚   â””â”€ try/catch + ìŠ¬ëŸ¬ê·¸ í´ë°± (pose_reservation vs        â”‚
â”‚       â”‚      pose-reservation) + ìƒíƒœ ì½”ë“œ ë§¤í•‘                    â”‚
â”‚       â”‚                                                          â”‚
â”‚       â””â”€ ì¼ë¶€ routeì— try/catch ì—†ìŒ                              â”‚
â”‚           â””â”€ pose-guides, reservation GET â†’ ì—ëŸ¬ ì „íŒŒ ê°€ëŠ¥         â”‚
â”‚                                                                  â”‚
â”‚  [í´ë¼ì´ì–¸íŠ¸]                                                     â”‚
â”‚       â””â”€ fetch â†’ !res.ok â†’ ì¼ë¶€ í˜ì´ì§€ì—ì„œ ì—ëŸ¬ ìƒíƒœ ì„¤ì •          â”‚
â”‚          âš ï¸ í†µì¼ëœ ì—ëŸ¬ UI/í† ìŠ¤íŠ¸ íŒ¨í„´ ì—†ìŒ                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë¬¸ì œì  ìš”ì•½**:

| # | ë¬¸ì œ | ì˜í–¥ë„ |
|---|------|:-----:|
| 1 | ì—ëŸ¬ê°€ `null`/`[]`ë¡œ í¡ìˆ˜ë˜ì–´ ì›ì¸ ì¶”ì  ë¶ˆê°€ | â­â­â­â­â­ |
| 2 | HTTP ìƒíƒœ ì½”ë“œê°€ í´ë¼ì´ì–¸íŠ¸ê¹Œì§€ ì „ë‹¬ë˜ì§€ ì•ŠìŒ | â­â­â­â­ |
| 3 | ì‚¬ìš©ìì—ê²Œ êµ¬ì²´ì  ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ë¶ˆê°€ | â­â­â­â­ |
| 4 | ì¬ì‹œë„(retry) ë¡œì§ ì—†ìŒ | â­â­â­ |
| 5 | íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ ì—†ìŒ | â­â­â­ |
| 6 | Sentry ë“± ì—ëŸ¬ ë¦¬í¬íŒ… ì—†ìŒ | â­â­â­ |

---

### 2.2 ì•±ì˜ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´ ë¶„ì„

ì•±ì€ **êµ¬ì¡°ì  ì—ëŸ¬ í•´ê²°(Structured Error Resolution)** íŒ¨í„´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

```typescript
// ì•±ì˜ í•µì‹¬ íŒ¨í„´: resolveApiErrorOrThrow
function resolveApiErrorOrThrow<T>(
  e: unknown,
  handlers: Record<number, (data?: ApiResponse) => T | void>
) {
  if (!isApiError(e)) throw e;                    // API ì—ëŸ¬ê°€ ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ throw
  const status = e.response?.data.statusCode ?? e.status;
  if (status && handlers[status]) {
    const result = handlers[status](e.response?.data);
    if (result === undefined) throw e;             // í•¸ë“¤ëŸ¬ê°€ voidë©´ throw
    return result;                                 // í•¸ë“¤ëŸ¬ ë°˜í™˜ê°’ ì‚¬ìš©
  }
  throw e;                                         // ë¯¸ë“±ë¡ ìƒíƒœì½”ë“œëŠ” throw
}
```

**ì•±ì˜ ì—ëŸ¬ ì²˜ë¦¬ ê³„ì¸µ**:

```
[ìµœí•˜ìœ„] Axios ì¸í„°ì…‰í„°
    â”œâ”€ 401 â†’ ìë™ í† í° ë¦¬í”„ë ˆì‹œ (ëŒ€ê¸° í íŒ¨í„´)
    â”œâ”€ 4xx/5xx ë¡œê·¸ â†’ Sentry (401/403/404 ì œì™¸)
    â””â”€ ì—ëŸ¬ ê°ì²´ ì „íŒŒ

[ì¤‘ê°„ì¸µ] ë„ë©”ì¸ ì„œë¹„ìŠ¤ (resolveApiErrorOrThrow)
    â”œâ”€ 409 FOLDER_ALREADY_EXISTS â†’ ì—ëŸ¬ í† ìŠ¤íŠ¸
    â”œâ”€ 422 NOT_AVAILABLE_TOUR â†’ ì—ëŸ¬ í† ìŠ¤íŠ¸
    â”œâ”€ 404 USER_NOT_FOUND â†’ íšŒì›ê°€ì… í™”ë©´
    â””â”€ ë¯¸ì²˜ë¦¬ â†’ throw (ìƒìœ„ë¡œ ì „íŒŒ)

[ìµœìƒìœ„] useAppMutation (ê¸€ë¡œë²Œ í•¸ë“¤ëŸ¬)
    â””â”€ 500-599 â†’ ì„œë²„ ì—ëŸ¬ í† ìŠ¤íŠ¸ ìë™ í‘œì‹œ
```

---

### 2.3 í†µí•© ì—ëŸ¬ í•¸ë“¤ë§ ì„¤ê³„ì•ˆ

ë‘ íŒ¨í„´ì„ í†µí•©í•˜ì—¬ **3ê³„ì¸µ ì—ëŸ¬ ì²˜ë¦¬ ì•„í‚¤í…ì²˜**ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            í†µí•© ì—ëŸ¬ ì²˜ë¦¬ ì•„í‚¤í…ì²˜ (3-Layer)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Layer 1: API í´ë¼ì´ì–¸íŠ¸ (lib/api-error.ts) â”€â”€â”€ ì‹ ê·œ ìƒì„±        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚                                                                  â”‚
â”‚  // ì•±ì˜ resolveApiErrorOrThrowë¥¼ Next.jsìš©ìœ¼ë¡œ í¬íŒ…             â”‚
â”‚                                                                  â”‚
â”‚  class ApiError extends Error {                                  â”‚
â”‚    status: number;                                               â”‚
â”‚    code: string;        // 'FOLDER_ALREADY_EXISTS' ë“±            â”‚
â”‚    data?: unknown;      // ì›ë³¸ ì‘ë‹µ ë°”ë””                         â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  // Bubble API ë˜í¼ â€” null ë°˜í™˜ ëŒ€ì‹  ì—ëŸ¬ throw                   â”‚
â”‚  async function bubbleFetch<T>(url, options): Promise<T> {       â”‚
â”‚    const res = await fetch(url, options);                        â”‚
â”‚    if (!res.ok) {                                                â”‚
â”‚      const body = await res.text().catch(() => '');              â”‚
â”‚      throw new ApiError(res.status, body, url);                  â”‚
â”‚    }                                                             â”‚
â”‚    return res.json();                                            â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  // Java ë°±ì—”ë“œ ë˜í¼ â€” ë™ì¼ íŒ¨í„´                                  â”‚
â”‚  async function javaFetch<T>(url, options): Promise<T> { ... }   â”‚
â”‚                                                                  â”‚
â”‚  // ì—ëŸ¬ í•´ê²° í•¨ìˆ˜ (ì•± íŒ¨í„´ í¬íŒ…)                                  â”‚
â”‚  function resolveApiErrorOrThrow<T>(                             â”‚
â”‚    e: unknown,                                                   â”‚
â”‚    handlers: Record<number, (err: ApiError) => T | void>         â”‚
â”‚  ): T { ... }                                                    â”‚
â”‚                                                                  â”‚
â”‚                                                                  â”‚
â”‚  Layer 2: API Route (app/api/) â”€â”€â”€ ê¸°ì¡´ route ë¦¬íŒ©í„°ë§           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚                                                                  â”‚
â”‚  // í‘œì¤€í™”ëœ ì‘ë‹µ í¬ë§·                                             â”‚
â”‚  type ApiResponse<T> = {                                         â”‚
â”‚    success: boolean;                                             â”‚
â”‚    data?: T;                                                     â”‚
â”‚    error?: {                                                     â”‚
â”‚      code: string;      // ë¨¸ì‹  ë¦¬ë”ë¸” ì½”ë“œ                       â”‚
â”‚      message: string;   // ì‚¬ìš©ì í‘œì‹œìš© ë©”ì‹œì§€                    â”‚
â”‚      details?: unknown; // ë””ë²„ê·¸ ì •ë³´ (dev only)                 â”‚
â”‚    };                                                            â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  // ì—ëŸ¬ í•¸ë“¤ë§ ë¯¸ë“¤ì›¨ì–´ (withErrorHandler HOF)                    â”‚
â”‚  function withErrorHandler(handler) {                            â”‚
â”‚    return async (req, ctx) => {                                  â”‚
â”‚      try {                                                       â”‚
â”‚        return await handler(req, ctx);                           â”‚
â”‚      } catch (e) {                                               â”‚
â”‚        if (e instanceof ApiError) {                              â”‚
â”‚          return NextResponse.json(                               â”‚
â”‚            { success: false, error: { code, message } },         â”‚
â”‚            { status: e.status }                                  â”‚
â”‚          );                                                      â”‚
â”‚        }                                                         â”‚
â”‚        // Sentry.captureException(e);                            â”‚
â”‚        return NextResponse.json(                                 â”‚
â”‚          { success: false, error: { code: 'INTERNAL_ERROR' } },  â”‚
â”‚          { status: 500 }                                         â”‚
â”‚        );                                                        â”‚
â”‚      }                                                           â”‚
â”‚    };                                                            â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚                                                                  â”‚
â”‚  Layer 3: í´ë¼ì´ì–¸íŠ¸ (hooks/use-api.ts) â”€â”€â”€ ì‹ ê·œ ìƒì„±            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚                                                                  â”‚
â”‚  // ì•±ì˜ useAppMutation íŒ¨í„´ í¬íŒ…                                 â”‚
â”‚  function useApiMutation<T>(options) {                           â”‚
â”‚    return {                                                      â”‚
â”‚      mutate: async (...args) => {                                â”‚
â”‚        try {                                                     â”‚
â”‚          const res = await fetch(...);                            â”‚
â”‚          if (!res.ok) {                                           â”‚
â”‚            const body = await res.json();                         â”‚
â”‚            if (res.status >= 500) {                               â”‚
â”‚              toast.error('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');               â”‚
â”‚            }                                                      â”‚
â”‚            throw new ClientApiError(res.status, body);            â”‚
â”‚          }                                                        â”‚
â”‚          return res.json();                                       â”‚
â”‚        } catch (e) {                                              â”‚
â”‚          options.onError?.(e);                                    â”‚
â”‚          throw e;                                                 â”‚
â”‚        }                                                          â”‚
â”‚      }                                                            â”‚
â”‚    };                                                             â”‚
â”‚  }                                                                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 ê¸°ì¡´ bubble-api.ts ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ

ê¸°ì¡´ ì½”ë“œë¥¼ í•œ ë²ˆì— ë°”ê¾¸ì§€ ì•Šê³  **ì ì§„ì  ë¦¬íŒ©í„°ë§**ì„ ê¶Œì¥í•©ë‹ˆë‹¤:

| ë‹¨ê³„ | ì‘ì—… | ì˜í–¥ ë²”ìœ„ |
|:---:|------|----------|
| 1 | `lib/api-error.ts` ìƒì„± (ApiError í´ë˜ìŠ¤, resolveApiErrorOrThrow) | ì‹ ê·œ íŒŒì¼, ê¸°ì¡´ ì½”ë“œ ë¯¸ë³€ê²½ |
| 2 | ìƒˆë¡œìš´ mutation routeë¶€í„° `withErrorHandler` + `bubbleFetch` ì ìš© | ì‹ ê·œ routeë§Œ |
| 3 | ê¸°ì¡´ mutation routes ë¦¬íŒ©í„°ë§ (pose-reservation, reserved-pose, cancel-reservation) | 3ê°œ íŒŒì¼ |
| 4 | lib í•¨ìˆ˜ë“¤ì˜ `return null` â†’ `throw ApiError` ì „í™˜ (í•˜ë‚˜ì”©) | ì ì§„ì  |
| 5 | í´ë¼ì´ì–¸íŠ¸ `useApiMutation` í›… ë„ì… + ê¸€ë¡œë²Œ í† ìŠ¤íŠ¸ ì—ëŸ¬ í•¸ë“¤ë§ | ì „ì²´ í˜ì´ì§€ |

---

## 3. ì¸ì¦ ë° ì„¸ì…˜ ìœ ì§€

### 3.1 í˜„ì¬ ì›¹ì˜ JWT í†µì‹  êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      í˜„ì¬ ì›¹ ì¸ì¦ ì•„í‚¤í…ì²˜                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [ë¸Œë¼ìš°ì €]                                                              â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (1)  â”‚ signIn("credentials", {email, password})                        â”‚
â”‚       â”‚ signIn("kakao")                                                 â”‚
â”‚       â”‚ signIn("google-direct", {idToken})                              â”‚
â”‚       â–¼                                                                 â”‚
â”‚  [NextAuth API Route]                                                   â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (2)  â”‚ authorize() / signIn() callback                                 â”‚
â”‚       â”‚   â””â”€ POST api.lifeshot.me/api/v1/auth/login                    â”‚
â”‚       â”‚   â””â”€ POST api.lifeshot.me/api/v1/auth/social/login/{provider}  â”‚
â”‚       â–¼                                                                 â”‚
â”‚  [Java ë°±ì—”ë“œ ì‘ë‹µ]                                                      â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (3)  â”‚ Authorization: Bearer eyJhbGciOiJ...  â—„â”€â”€ ë°±ì—”ë“œ JWT            â”‚
â”‚       â”‚ Body: { data: { id, nickname, email, role } }                   â”‚
â”‚       â–¼                                                                 â”‚
â”‚  [NextAuth JWT Callback]                                                â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (4)  â”‚ token.accessToken = "eyJhbGciOiJ..."  â—„â”€â”€ ë°±ì—”ë“œ JWT ì €ì¥      â”‚
â”‚       â”‚ token.userId = 123                                              â”‚
â”‚       â”‚ token.role = "User"                                             â”‚
â”‚       â–¼                                                                 â”‚
â”‚  [NextAuth ì¿ í‚¤]                                                        â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (5)  â”‚ next-auth.session-token = <encrypted JWT containing:            â”‚
â”‚       â”‚   { accessToken, userId, role, ... }>                           â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â”‚ âš ï¸ ì´ê²ƒì€ NextAuth JWTì´ë©°, ë‚´ë¶€ì— ë°±ì—”ë“œ JWTê°€ í¬í•¨ë¨          â”‚
â”‚       â–¼                                                                 â”‚
â”‚  [í´ë¼ì´ì–¸íŠ¸ API í˜¸ì¶œ]                                                   â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (6)  â”‚ getSession() â†’ session.accessToken â†’ "eyJhbGciOiJ..."          â”‚
â”‚       â”‚ Authorization: Bearer eyJhbGciOiJ...  â”€â”€â–¶ api.lifeshot.me      â”‚
â”‚       â”‚                                                                 â”‚
â”‚       â”‚ âš ï¸ í´ë°±: sessionStorage.getItem("auth_token")                  â”‚
â”‚       â–¼                                                                 â”‚
â”‚  [Bubble API í˜¸ì¶œ] (ì„œë²„ì‚¬ì´ë“œ ì „ìš©)                                     â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (7)  â”‚ Authorization: Bearer {BUBBLE_API_TOKEN}  â”€â”€â–¶ Bubble.io        â”‚
â”‚       â”‚ âš ï¸ ì´ê²ƒì€ í™˜ê²½ë³€ìˆ˜ì˜ ê³ ì • í† í°ì´ë©°, ì‚¬ìš©ìë³„ì´ ì•„ë‹˜             â”‚
â”‚       â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ êµ¬ë¶„**: ì›¹ì—ì„œ ë‘ ì¢…ë¥˜ì˜ JWTê°€ ë™ì‹œì— ì¡´ì¬í•©ë‹ˆë‹¤.

| JWT ì¢…ë¥˜ | ì €ì¥ ìœ„ì¹˜ | ìš©ë„ | ìˆ˜ëª… |
|----------|----------|------|------|
| **NextAuth JWT** | `next-auth.session-token` ì¿ í‚¤ (ì•”í˜¸í™”) | RBAC, ì„¸ì…˜ ê´€ë¦¬, ë°±ì—”ë“œ JWT ìš´ë°˜ | NextAuth ì„¤ì • (ê¸°ë³¸ 30ì¼) |
| **ë°±ì—”ë“œ JWT** | NextAuth JWT ë‚´ë¶€ì˜ `accessToken` í•„ë“œ | Java API ì¸ì¦ | ë°±ì—”ë“œ ì„¤ì • (í™•ì¸ í•„ìš”) |
| **Bubble API Token** | `.env.local` í™˜ê²½ ë³€ìˆ˜ | Bubble.io Data API ì¸ì¦ | ë¬´ê¸°í•œ (ìˆ˜ë™ êµì²´) |

---

### 3.2 ì•±ì˜ ì¸ì¦ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì•± ì¸ì¦ ì•„í‚¤í…ì²˜                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [ëª¨ë°”ì¼ ì•±]                                                             â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (1)  â”‚ Kakao/Google/Apple/LINE SDK â†’ socialToken                       â”‚
â”‚       â”‚ Email + Password                                                â”‚
â”‚       â–¼                                                                 â”‚
â”‚  [Java ë°±ì—”ë“œ]                                                           â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (2)  â”‚ POST /api/v1/auth/social/login/{provider}                      â”‚
â”‚       â”‚ POST /api/v1/auth/login                                        â”‚
â”‚       â–¼                                                                 â”‚
â”‚  [ì‘ë‹µ]                                                                  â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (3)  â”‚ Access Token (JWT) â†’ ì¸ë©”ëª¨ë¦¬ ì €ì¥ (inMemoryStorage)             â”‚
â”‚       â”‚ Refresh Token      â†’ ì•”í˜¸í™” ì €ì¥ (EncryptedStorage)              â”‚
â”‚       â–¼                                                                 â”‚
â”‚  [API í˜¸ì¶œ]                                                              â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (4)  â”‚ Authorization: Bearer {Access Token}                            â”‚
â”‚       â”‚                                                                 â”‚
â”‚  [401 ë°œìƒ ì‹œ]                                                           â”‚
â”‚       â”‚                                                                 â”‚
â”‚  (5)  â”‚ Axios ì¸í„°ì…‰í„°ê°€ ìë™ìœ¼ë¡œ:                                        â”‚
â”‚       â”‚   â”œâ”€ ëŒ€ê¸° íì— ì›ë³¸ ìš”ì²­ ì¶”ê°€                                     â”‚
â”‚       â”‚   â”œâ”€ POST /api/v1/auth/refresh (Refresh Token)                  â”‚
â”‚       â”‚   â”œâ”€ ì„±ê³µ â†’ ìƒˆ Access Token ì €ì¥ â†’ ëŒ€ê¸° í ì¬ì‹¤í–‰                â”‚
â”‚       â”‚   â””â”€ ì‹¤íŒ¨ â†’ ë¡œê·¸ì•„ì›ƒ (ëª¨ë“  í† í° ì‚­ì œ + Sentry ì´ˆê¸°í™”)             â”‚
â”‚       â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.3 ë‘ ë°©ì‹ì˜ ê³µì¡´ ì„¤ê³„

í†µí•© ì›¹ì—ì„œ ì•±ê³¼ ì›¹ì˜ ì¸ì¦ ë°©ì‹ì´ ê³µì¡´í•´ì•¼ í•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               í†µí•© ì¸ì¦ ì•„í‚¤í…ì²˜ (ê¶Œì¥ì•ˆ)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                    NextAuth (ì„¸ì…˜ ê´€ë¦¬)                       â”‚       â”‚
â”‚  â”‚                                                             â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚
â”‚  â”‚  â”‚  NextAuth JWT Cookie (encrypted)                    â”‚   â”‚       â”‚
â”‚  â”‚  â”‚                                                     â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  {                                                  â”‚   â”‚       â”‚
â”‚  â”‚  â”‚    accessToken: "eyJ...",   // Java ë°±ì—”ë“œ JWT      â”‚   â”‚       â”‚
â”‚  â”‚  â”‚    refreshToken: "eyJ...",  // â˜… ì‹ ê·œ: ë¦¬í”„ë ˆì‹œ í† í° â”‚   â”‚       â”‚
â”‚  â”‚  â”‚    accessTokenExpiry: 1707..., // â˜… ì‹ ê·œ: ë§Œë£Œ ì‹œê°  â”‚   â”‚       â”‚
â”‚  â”‚  â”‚    userId: 123,                                     â”‚   â”‚       â”‚
â”‚  â”‚  â”‚    role: "User",                                    â”‚   â”‚       â”‚
â”‚  â”‚  â”‚    ...                                              â”‚   â”‚       â”‚
â”‚  â”‚  â”‚  }                                                  â”‚   â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚
â”‚  â”‚                                                             â”‚       â”‚
â”‚  â”‚  JWT Callback ìˆ˜ì • (í† í° ë¦¬í”„ë ˆì‹œ ì¶”ê°€):                     â”‚       â”‚
â”‚  â”‚                                                             â”‚       â”‚
â”‚  â”‚  async jwt({ token }) {                                     â”‚       â”‚
â”‚  â”‚    // ê¸°ì¡´ ë¡œì§ ìœ ì§€ (user ì´ˆê¸° ì„¤ì •)                         â”‚       â”‚
â”‚  â”‚                                                             â”‚       â”‚
â”‚  â”‚    // â˜… ì‹ ê·œ: Access Token ë§Œë£Œ ì²´í¬                         â”‚       â”‚
â”‚  â”‚    if (token.accessTokenExpiry &&                           â”‚       â”‚
â”‚  â”‚        Date.now() > token.accessTokenExpiry - 60_000) {     â”‚       â”‚
â”‚  â”‚      try {                                                  â”‚       â”‚
â”‚  â”‚        const res = await fetch(                             â”‚       â”‚
â”‚  â”‚          `${API_BASE_URL}/api/v1/auth/refresh`,             â”‚       â”‚
â”‚  â”‚          { method: 'POST',                                  â”‚       â”‚
â”‚  â”‚            headers: { 'Authorization':                      â”‚       â”‚
â”‚  â”‚              `Bearer ${token.refreshToken}` } }             â”‚       â”‚
â”‚  â”‚        );                                                   â”‚       â”‚
â”‚  â”‚        const data = await res.json();                       â”‚       â”‚
â”‚  â”‚        token.accessToken = data.accessToken;                â”‚       â”‚
â”‚  â”‚        token.accessTokenExpiry = data.expiry;               â”‚       â”‚
â”‚  â”‚      } catch {                                              â”‚       â”‚
â”‚  â”‚        // ë¦¬í”„ë ˆì‹œ ì‹¤íŒ¨ â†’ ì„¸ì…˜ ë¬´íš¨í™”                         â”‚       â”‚
â”‚  â”‚        return { ...token, error: "RefreshFailed" };         â”‚       â”‚
â”‚  â”‚      }                                                      â”‚       â”‚
â”‚  â”‚    }                                                        â”‚       â”‚
â”‚  â”‚    return token;                                            â”‚       â”‚
â”‚  â”‚  }                                                          â”‚       â”‚
â”‚  â”‚                                                             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚              API í˜¸ì¶œ ê²½ë¡œ (í†µí•© í›„)                          â”‚       â”‚
â”‚  â”‚                                                             â”‚       â”‚
â”‚  â”‚  [í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸]                                       â”‚       â”‚
â”‚  â”‚       â”‚                                                     â”‚       â”‚
â”‚  â”‚       â”œâ”€ Java API ì§ì ‘ í˜¸ì¶œ (í´ë¼ì´ì–¸íŠ¸ â†’ Java)             â”‚       â”‚
â”‚  â”‚       â”‚   â””â”€ getSession().accessToken â†’ Authorization í—¤ë”  â”‚       â”‚
â”‚  â”‚       â”‚   â””â”€ 401 â†’ signOut() â†’ /auth/signin                â”‚       â”‚
â”‚  â”‚       â”‚                                                     â”‚       â”‚
â”‚  â”‚       â””â”€ Bubble API í˜¸ì¶œ (í´ë¼ì´ì–¸íŠ¸ â†’ Next.js â†’ Bubble)    â”‚       â”‚
â”‚  â”‚           â””â”€ fetch('/api/bubble/...') â†’ ì„œë²„ì‚¬ì´ë“œ í”„ë¡ì‹œ    â”‚       â”‚
â”‚  â”‚           â””â”€ BUBBLE_API_TOKENìœ¼ë¡œ ì¸ì¦ (ì‚¬ìš©ì ë¬´ê´€)         â”‚       â”‚
â”‚  â”‚                                                             â”‚       â”‚
â”‚  â”‚  [ì„œë²„ ì»´í¬ë„ŒíŠ¸ / API Route]                                 â”‚       â”‚
â”‚  â”‚       â”‚                                                     â”‚       â”‚
â”‚  â”‚       â”œâ”€ Java API í˜¸ì¶œ (ì„œë²„ â†’ Java)                        â”‚       â”‚
â”‚  â”‚       â”‚   â””â”€ getServerSession().accessToken                 â”‚       â”‚
â”‚  â”‚       â”‚   â””â”€ ë˜ëŠ” getToken(req).accessToken                 â”‚       â”‚
â”‚  â”‚       â”‚                                                     â”‚       â”‚
â”‚  â”‚       â””â”€ Bubble API í˜¸ì¶œ (ì„œë²„ â†’ Bubble)                    â”‚       â”‚
â”‚  â”‚           â””â”€ BUBBLE_API_TOKEN í™˜ê²½ë³€ìˆ˜                      â”‚       â”‚
â”‚  â”‚                                                             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 í˜„ì¬ ì›¹ì˜ ì¸ì¦ ì·¨ì•½ì  ë° í•´ê²°ë°©ì•ˆ

| # | ì·¨ì•½ì  | í˜„ì¬ ë™ì‘ | í†µí•© í•´ê²°ë°©ì•ˆ |
|---|--------|---------|-------------|
| 1 | **Access Token ë¦¬í”„ë ˆì‹œ ì—†ìŒ** | ë°±ì—”ë“œ JWT ë§Œë£Œ ì‹œ 401 â†’ ìˆ˜ë™ ì¬ë¡œê·¸ì¸ í•„ìš” | NextAuth JWT callbackì—ì„œ ë§Œë£Œ ì²´í¬ â†’ ìë™ ë¦¬í”„ë ˆì‹œ (ìœ„ ì„¤ê³„ ì°¸ì¡°) |
| 2 | **sessionStorage í´ë°±** | `auth_token`ì„ sessionStorageì— ì¤‘ë³µ ì €ì¥ | ì œê±°. NextAuth ì„¸ì…˜ë§Œ ì‚¬ìš© |
| 3 | **ì„œë²„ì‚¬ì´ë“œ API í˜¸ì¶œ ì‹œ í† í° ì ‘ê·¼ ë¶ˆê°€** | `getHeaders(true)`ê°€ ì„œë²„ì—ì„œ ì‹¤íŒ¨ | `getServerSession(authOptions)` ë˜ëŠ” `getToken(req)` ì‚¬ìš© |
| 4 | **`/auth/signup`ì´ ë³´í˜¸ëœ ê²½ë¡œ** | middlewareì—ì„œ publicPathsì— ë¯¸í¬í•¨ | `/auth/signup`ì„ publicPathsì— ì¶”ê°€ |
| 5 | **í† í° ìœ íš¨ì„± ë¯¸ê²€ì¦** | ë§Œë£Œ/ë³€ì¡°ëœ í† í°ë„ ê·¸ëŒ€ë¡œ ì „ì†¡ | JWT callbackì—ì„œ `exp` í•„ë“œ ì²´í¬ |
| 6 | **ì†Œì…œ ë¡œê·¸ì¸ ì‹œ profileComplete=false** | ì†Œì…œ ë¡œê·¸ì¸ í›„ í”„ë¡œí•„ ì™„ì„± í”Œë¡œìš° ì—†ìŒ | í”„ë¡œí•„ ì™„ì„± í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì•±ì˜ íŒ¨í„´ ì°¸ì¡°) |

### 3.5 ì•±â†”ì›¹ ì¸ì¦ ê³µì¡´ ì‹œë‚˜ë¦¬ì˜¤

ê°™ì€ ì‚¬ìš©ìê°€ ì•±ê³¼ ì›¹ì„ ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ë™ì‹œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  [ì•±]                          [ì›¹]                           â”‚
â”‚   â”‚                             â”‚                             â”‚
â”‚   â”‚ Access Token (ì¸ë©”ëª¨ë¦¬)     â”‚ Access Token (NextAuth ì¿ í‚¤) â”‚
â”‚   â”‚ Refresh Token (ì•”í˜¸í™”ì €ì¥)  â”‚ Refresh Token (NextAuth ì¿ í‚¤)â”‚
â”‚   â”‚                             â”‚                             â”‚
â”‚   â”‚ â—„â”€â”€ ê°™ì€ Java ë°±ì—”ë“œ â”€â”€â”€â–¶  â”‚                             â”‚
â”‚   â”‚        api.lifeshot.me      â”‚                             â”‚
â”‚   â”‚                             â”‚                             â”‚
â”‚   â”‚ âš ï¸ í† í°ì´ ë…ë¦½ì              â”‚                             â”‚
â”‚   â”‚ â†’ ì•±ì—ì„œ ë¡œê·¸ì•„ì›ƒí•´ë„       â”‚                             â”‚
â”‚   â”‚   ì›¹ì€ ì˜í–¥ ì—†ìŒ            â”‚                             â”‚
â”‚   â”‚ â†’ ì›¹ì—ì„œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œ   â”‚                             â”‚
â”‚   â”‚   ì•± í† í°ì€ ë¦¬í”„ë ˆì‹œ ì‹¤íŒ¨   â”‚                             â”‚
â”‚   â”‚   â†’ ìë™ ë¡œê·¸ì•„ì›ƒ           â”‚                             â”‚
â”‚                                                               â”‚
â”‚  [ì¶”ê°€ ê³ ë ¤ ì‚¬í•­]                                              â”‚
â”‚   - ì•±ì—ì„œ ì˜ˆì•½ ìƒì„± â†’ ì›¹ì—ì„œë„ ì¡°íšŒ ê°€ëŠ¥ (folder_Id ê³µìœ )     â”‚
â”‚   - ì›¹ì—ì„œ í¬ì¦ˆ ì„ íƒ â†’ í¬í† ê·¸ë˜í¼ ì•±ì—ì„œ QR ìŠ¤ìº” ê°€ëŠ¥          â”‚
â”‚   - Bubble ë°ì´í„°ëŠ” ì–‘ìª½ ëª¨ë‘ ì ‘ê·¼ ê°€ëŠ¥ (API Token ê³µìœ )       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. í†µí•© ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡œë“œë§µ

### 4.1 Phase 1: ì¸í”„ë¼ í†µí•© (Week 1-2)

| ì‘ì—… | íŒŒì¼ | ì„¤ëª… |
|------|------|------|
| `lib/api-error.ts` ìƒì„± | ì‹ ê·œ | ApiError í´ë˜ìŠ¤, resolveApiErrorOrThrow, isApiError |
| JWT ë¦¬í”„ë ˆì‹œ êµ¬í˜„ | `lib/auth.ts` | JWT callbackì—ì„œ accessToken ë§Œë£Œ ì²´í¬ + ë¦¬í”„ë ˆì‹œ |
| sessionStorage í´ë°± ì œê±° | `lib/api-client.ts` | NextAuth ì„¸ì…˜ë§Œ ì‚¬ìš©í•˜ë„ë¡ ë‹¨ìˆœí™” |
| ì„œë²„ì‚¬ì´ë“œ í† í° ì ‘ê·¼ | `lib/api-client.ts` | `getServerSession(authOptions)` ì§€ì› ì¶”ê°€ |
| `/auth/signup` ê³µê°œ | `middleware.ts` | publicPathsì— ì¶”ê°€ |
| `withErrorHandler` HOF | `lib/route-helpers.ts` ì‹ ê·œ | API Route ê³µí†µ ì—ëŸ¬ í•¸ë“¤ë§ ë˜í¼ |

### 4.2 Phase 2: ê²°ì œ í”Œë¡œìš° (Week 3-4)

| ì‘ì—… | íŒŒì¼ | ì„¤ëª… |
|------|------|------|
| Stripe.js ì„¤ì¹˜ | `package.json` | `@stripe/stripe-js`, `@stripe/react-stripe-js` |
| Stripe Webhook | `app/api/payment/webhook/route.ts` ì‹ ê·œ | PaymentIntent ìƒíƒœ ì—…ë°ì´íŠ¸ |
| ì˜ˆì•½ ê²°ì œ í˜ì´ì§€ | `app/cheiz/reserve/payment/page.tsx` ì‹ ê·œ | Stripe PaymentElement |
| ì£¼ë¬¸ ê²°ì œ í˜ì´ì§€ | `app/cheiz/order/payment/page.tsx` ì‹ ê·œ | ì‚¬ì§„ ì„ íƒ â†’ ë¦¬í„°ì²˜ â†’ ê²°ì œ |
| Payment API Routes | `app/api/payment/` ì‹ ê·œ | PaymentIntent ìƒì„±/ì·¨ì†Œ |

### 4.3 Phase 3: ì•± ì „ìš© ê¸°ëŠ¥ ì´ì‹ (Week 5-8)

| ì‘ì—… | ìš°ì„ ìˆœìœ„ | ì„¤ëª… |
|------|:-------:|------|
| Schedule ì„ íƒ UI | â­â­â­â­â­ | íˆ¬ì–´ ìƒì„¸ì—ì„œ ë‚ ì§œ/ì‹œê°„ ìŠ¬ë¡¯ ì„ íƒ |
| Order ìƒì„± í”Œë¡œìš° | â­â­â­â­â­ | ì‚¬ì§„ ì„ íƒ â†’ ë¦¬í„°ì²˜ ì„ íƒ â†’ ì£¼ë¬¸ |
| Album ì—´ëŒ/ë‹¤ìš´ë¡œë“œ | â­â­â­â­ | ë³´ì • ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ + ë‹¤ìš´ë¡œë“œ |
| ë‹¤êµ­ì–´ (i18n) | â­â­â­â­ | `next-intl` ë„ì… + ì•± ë²ˆì—­ íŒŒì¼ ì¬ì‚¬ìš© |
| í™˜ë¶ˆ ì²˜ë¦¬ | â­â­â­ | ì£¼ë¬¸ ìƒì„¸ì—ì„œ í™˜ë¶ˆ ìš”ì²­ |
| í”„ë¡œí•„ í¸ì§‘ | â­â­â­ | ë‹‰ë„¤ì„, í”„ë¡œí•„ ì´ë¯¸ì§€, ì–¸ì–´ ì„¤ì • |
| Web Push ì•Œë¦¼ | â­â­ | Service Worker + FCM Web |
| í¬ë ˆë”§/ì¿ í° (Gift) | â­â­ | ê²°ì œ ì‹œ í¬ë ˆë”§ ì°¨ê° |

### 4.4 ë§ˆì´ê·¸ë ˆì´ì…˜ ìœ„í—˜ë„ ë§¤íŠ¸ë¦­ìŠ¤

| ì˜ì—­ | ìœ„í—˜ë„ | ì´ìœ  | ì™„í™” ë°©ì•ˆ |
|------|:-----:|------|---------|
| Stripe ê²°ì œ | ğŸ”´ ë†’ìŒ | Payment Sheet â†’ Elements ì™„ì „ ì¬êµ¬í˜„. 3D Secure íë¦„ ì°¨ì´ | Stripe ê³µì‹ Next.js ì˜ˆì œ ì°¸ì¡°. í…ŒìŠ¤íŠ¸ ëª¨ë“œì—ì„œ ì² ì €íˆ ê²€ì¦ |
| í† í° ë¦¬í”„ë ˆì‹œ | ğŸ”´ ë†’ìŒ | í˜„ì¬ ì›¹ì— ì—†ëŠ” ê¸°ëŠ¥. êµ¬í˜„ ì˜¤ë¥˜ ì‹œ ì‚¬ìš©ì ì „ì› ë¡œê·¸ì•„ì›ƒ | NextAuth JWT callbackì—ì„œ êµ¬í˜„. ì‹¤íŒ¨ ì‹œ graceful degradation |
| Bubble â†” Java ID ë§¤í•‘ | ğŸŸ¡ ì¤‘ê°„ | `folder_Id` ë¸Œë¦¿ì§€ê°€ ì •í™•íˆ ë™ê¸°í™”ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ | folder_Idë¥¼ URL paramìœ¼ë¡œ ì¼ê´€ë˜ê²Œ ì „ë‹¬. ëˆ„ë½ ì‹œ ì¡°íšŒ fallback |
| ì—ëŸ¬ í•¸ë“¤ë§ ì „í™˜ | ğŸŸ¡ ì¤‘ê°„ | `return null` â†’ `throw` ì „í™˜ ì‹œ ê¸°ì¡´ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œê°€ ê¹¨ì§ˆ ìˆ˜ ìˆìŒ | ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜. ê¸°ì¡´ í•¨ìˆ˜ ë˜í¼ ìœ ì§€í•˜ë©° ìƒˆ í•¨ìˆ˜ ë³‘í–‰ |
| ë‹¤êµ­ì–´ | ğŸŸ¢ ë‚®ìŒ | ì•± ë²ˆì—­ íŒŒì¼ êµ¬ì¡° ì¬ì‚¬ìš© ê°€ëŠ¥ | `next-intl`ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë§¤í•‘ìœ¼ë¡œ ì§ì ‘ ì—°ê²° |

---

> **ë¬¸ì„œ ë²„ì „**: v1.0
> **ì‘ì„±ì**: AI Architect (Claude)
> **ë¶„ì„ ëŒ€ìƒ**: cheiz-web (Next.js 14) + cheiz-app (React Native 0.78.3)
> **ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-02-14
